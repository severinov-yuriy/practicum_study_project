# Отток клиентов

Из «Бета-Банка» стали уходить клиенты. Каждый месяц. Немного, но заметно. Банковские маркетологи посчитали: сохранять текущих клиентов дешевле, чем привлекать новых.

Нужно спрогнозировать, уйдёт клиент из банка в ближайшее время или нет. Вам предоставлены исторические данные о поведении клиентов и расторжении договоров с банком. 

Постройте модель с предельно большим значением *F1*-меры. Чтобы сдать проект успешно, нужно довести метрику до 0.59. Проверьте *F1*-меру на тестовой выборке самостоятельно.

Дополнительно измеряйте *AUC-ROC*, сравнивайте её значение с *F1*-мерой.

Источник данных: [https://www.kaggle.com/barelydedicated/bank-customer-churn-modeling](https://www.kaggle.com/barelydedicated/bank-customer-churn-modeling)

__Признаки:__
- `RowNumber` — индекс строки в данных
- `CustomerId` — уникальный идентификатор клиента
- `Surname` — фамилия
- `CreditScore` — кредитный рейтинг
- `Geography` — страна проживания
- `Gender` — пол
- `Age` — возраст
- `Tenure` — сколько лет человек является клиентом банка
- `Balance` — баланс на счёте
- `NumOfProducts` — количество продуктов банка, используемых клиентом
- `HasCrCard` — наличие кредитной карты
- `IsActiveMember` — активность клиента
- `EstimatedSalary` — предполагаемая зарплата


__Целевой признак:__
- `Exited` — факт ухода клиента

**Ход исследования:**

1. Обзор данных.

    __По результатам исследования данных можно сделать следующие выводы:__

    __1.__ В данных практически нет пропусков. Пропуски есть лишь в столбце `Tenure` в котором записано, сколько лет человек является клиентом банка. Это может быть как случайными пропусками в силу человеческого фактора при обработке данных, так и ошибкой считывания данных. Так как клиенты, являющиеся клиентами банка первый год отмечены в таблице нулевыми значениями, маловероятно, что пропуски в данных означают, что клиент сотрудничает с банком меньше года.


    __2.__ В среднем около 20% клиентов разорвали договор с банком. Несмотря на отрутствие данных по периоду, это все равно значительный процент клиентов и, судя по постановке задачи - он растет. Однако для нашей задачи - предсказание того, уйдет клиент или нет - это недостаточно большой процент. При обучении модели такой дисбаланс классов может снизить ее точность и его необходимо будет скорректировать для повышения точности предсказания.


    __3.__ Данные хранятся в привычном формате - например в столбце пола указана одна из двух характеристик: "Female" или "Male". Такое отображение удобно для человека, но не так подходит для алгоритмов машинного обучения. Необходимо закодировать данные таким образом, что бы все алгоритмы могли работать с ними.

        Воспользуемся методом One-Hot-Encoding для кодирования категориальных переменных. Отбросим один из столбцов что бы избежать
        дамми-ловушки. Для количественных переменных целесообразно масштабировать их с помощью инструмента StandartScaler модуля
        sklearn. 


    __4.__ Не совсем ясно, что предполагается под активностью клиента в столбце `IsActiveMember`. Такие данные было бы неплохо уточнить у коллег при возможности.


    __5.__ Данные хранятся в неподходящем виде. При расширении размеров датасета, целесообразно будет оптимизировать хранение данных, переведя их в менее ресурсозатратный тип.


    __6.__ Названия столбцов не соответсвуют общепринятому стилю в python. Переименуем их для удобства обработки.

2. Поготовка данных.
3. Исследование задачи. Вывод:

    Дисбаланс классов очень влияет на качество обучения моделей.

    Пока рано делать выводы о качестве той или иной модели. Логистическая регрессия не способна конкурировать с деревом решений или случайным лесом из-за дисбаланса классов. Необходимо устранить дисбаланс или найти другой способ оценить качество работы модели в равных с другими моделями условиях.

    Метрика ROC-AUC показала схожие результаты и оказалась наиболее высока у случайного леса.

4. Борьба с дисбалансом. Вывод: Наилучшие показатели, даже при сбалансированных классах, показала модель случайного леса. Модель логистической регрессии показала результат на уровне случайной модели, а дерево решений оказалось хуже модели случайного леса.
5. Тестирование моделей.
6. Общий вывод:

    Для целей предсказания оттока клиентов наиболее подходит модель случайного леса. Она предсказывает, уйдет клиент или нет, с достаточной точностью. Однако ее точность можно увеличить, добавив в данные более подходящие для предсказания переменные, а также настроив гиперпараметры.

    Дисбаланс очень влияет на обучение моделей и в особенности на обучение модели линейной регрессии. Однако и случайный лес и дерево решений показывают лучший результат на сбалансированной выборке.

    Также важно понимать, какие признаки вносят наибольший вклад в качество предсказания. Построим график важности признаков в обученной модели.
    
    Как ни странно, наиболее влиятельный признак - возраст. Влияние возраста на вероятность ухода клиента следует изучить отдельно, так как принимая соответсвующие управленческие решения, мы можем ориентировать деятельность нашего банка на сохранение клиентов на основании возраста - предложении более соответвующих продуктов клиентам.

    Количество продуктов и баланс также являются важными критериями при предсказании. Замыкают список данные о поле, географии и наличии кредитной карты.   